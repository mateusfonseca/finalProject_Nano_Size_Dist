// toggle Run Analysis and Remove File buttons on/off depending on whether an image has been uploaded
function toggleRunButton(target) {
    if (target.value === "") {
        Array.from(document.getElementsByClassName("hidden-button")).forEach(el => {
            el.style.display = "none"
        })
    } else {
        Array.from(document.getElementsByClassName("hidden-button")).forEach(el => {
            el.style.display = "initial"
        })
    }
}

// remove file selected for upload from input field and alert the buttons to be toggled
function removeFileButton() {
    let target = document.getElementById("img")
    target.value = ""
    target.dispatchEvent(new Event("change"))
}

// get list of projects to be displayed in the modal
function getProjectList(url, userId) {
    document.getElementById("save").disabled = true
    $.ajax({
        type: 'GET',
        url: url,
        data: {userId: userId},
        success: (projectList) => {
            displayProjectList(projectList)
        },
        error: () => {
            console.log("Something went wrong!")
            displayProjectList([])
        }
    })
}

// injects Bootstrap accordion containing list of projects to modal form
function displayProjectList(projectList) {
    if (Array.from(projectList).length !== 0) {
        let listToDisplay = ""
        Array.from(projectList).forEach(project => {
            listToDisplay +=
                '<div class="accordion-item">' +
                '<div class="form-check">' +
                '<input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" value="' + project.id + '">' +
                '<h2 class="accordion-header" id="heading' + project.id + '">' +
                '<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse' + project.id + '" aria-expanded="false" aria-controls="collapse' + project.id + '">' +
                project.title +
                '</button>' +
                '</h2>' +
                '<div id="collapse' + project.id + '" class="accordion-collapse collapse" aria-labelledby="heading' + project.id + '" data-bs-parent="#accordionExample">' +
                '<div class="accordion-body text-start">' +
                project.description +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>'
        })
        document.getElementById("project-list").innerHTML =
            '<div class="accordion" id="accordionExample">' +
            listToDisplay +
            '</div>'
    } else {
        document.getElementById("project-list").innerHTML = '<p>You have not created any projects yet.</p>'
    }
}

// enable Save button only after one of the radio buttons has been selected
function enableSaveButton() {
    document.getElementById("save").disabled = false
}

// save current analysis to selected project
function saveToProject(url, csrf_token, tmp_files) {
    $.ajax({
        type: 'POST',
        url: url,
        data: {
            csrfmiddlewaretoken: csrf_token,
            projectId: Number(document.querySelector('input:checked').value),
            tmpFiles: tmp_files
        },
        success: (url) => {
            window.location.href = url
        },
        error: () => {
            console.log("Something went wrong!")
        }
    })
}

// erase temporary files generated by the last analysis before leaving the page
function tempCleanUp(tmpdir, url, csrf_token) {
    if (tmpdir !== '') {
        $.ajax({
            type: 'POST',
            url: url,
            data: {csrfmiddlewaretoken: csrf_token, tmpdir: tmpdir}
        })
    }
}
